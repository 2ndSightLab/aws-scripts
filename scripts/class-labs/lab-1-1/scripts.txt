#####################################################################################################
# Copyright Notice
# All Rights Reserved.
# All course materials (the “Materials”) are protected by copyright under U.S. Copyright laws
# and are the property of 2nd Sight Lab. They are provided pursuant to a royalty free,
# perpetual license to the course attendee (the "Attendee") to whom they were presented by
# 2nd Sight Lab and are solely for the training and education of the Attendee. The Materials
# may not be copied, reproduced, distributed, offered for sale, published, displayed, performed,
# modified, used to create derivative works, transmitted to others, or used or exploited in any way,
# including, in whole or in part, as training materials by or for any third party.

# The above copyright notice and this permission notice shall be included in all copies or
# substantial portions of the Software.

# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING
# BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
# NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES
# OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
######################################################################################################

AWS AUTOMATION

aws --version

aws configure

aws help

aws ec2 help
aws ec2 describe-instances help

aws ec2 describe-instances

aws iam list-users

aws cloudtrail lookup-events --max-results 5

#BITBUCKET AND GIT

git --version

sudo yum update git

#login to BitBucket.org to see your repositories
#replace [directory name] with your bitbucket repository name
cd [directory name]
cd lab-1-1
ls

cat ec2-run-instance.sh

ls -al

chmod 700 ec2-run-instance.sh

#follow the steps in the lab to set your ami and security group id
vi ec2-run-instance.sh

ls -al

aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupName, GroupId]' --output table --color off

./ec2-run-instance.sh


#CLOUDFORMATION

cat securitygroup.yaml
cat ec2.yaml

aws cloudformation create-stack --stack-name SSHSecurityGroup --template-body file://securitygroup.yaml

aws cloudformation create-stack --stack-name EC2 --template-body file://ec2.yaml --parameters ParameterKey=AMIParameter,ParameterValue=[YOUR AMI ID HERE]

#CLEAN UP

#Delete the cloudformation EC2 instance stack
aws cloudformation delete-stack --stack-name EC2

#Make sure the stack is deleted in the CloudFormation console before proceeding

#Delete the Security Group stack
aws cloudformation delete-stack --stack-name SSHSecurityGroup

#List the EC2 instance IDs in your account.
aws ec2 describe-instances --query 'Reservations[*].Instances[*].{Instance:InstanceId}' --output text

#Run this command for each instance id you want to delete.
#!!If you terminate the instance you are logged into, you will be disconnected.
aws ec2 terminate-instances --instance-ids <instance ids separated by space>

#list your security groups again
aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupName, GroupId]' --output table --color off

#You should see the group you created manually: 2SL3000 SSH
#Keep that group for other labs. The other one was deleted by the CloudFormation stack deletion.
