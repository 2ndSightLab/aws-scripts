{
    "variables" : {
    	"ami-builder-region" : "",
			"name" : "",
    	"ami-name" : "",
			"ami-description" : "",
    	"ami-builder-vpc-id" : "",
    	"ami-builder-subnet-id" : "",
    	"ami-type" : "",
    	"kms-key-id" : "",
    	"ami" : "",
    	"volume-size" : "16",
    	"instance-type" : ""
    },
    "builders" : [
        {
            "ami_ou_arns" : "arn:aws:organizations::891705438963:ou/o-015pesw9wr/ou-fcww-enp111mg",
            "name" : "{{user `name` }}",
            "type" : "amazon-ebs",
      			"iam_instance_profile": "2sl-packer-instance-role",
            "ami_name" : "{{user `ami-name` }}",
            "ami_description" : "{{user `ami-description` }}",
            "region" : "{{ user `ami-builder-region` }}",
            "source_ami" : "{{ user `ami` }}",
            "instance_type" : "{{ user `instance-type` }}",
	    			"ssh_username" : "ec2-user",
            "associate_public_ip_address" : true,
            "vpc_id" : "{{ user `ami-builder-vpc-id` }}",
            "subnet_id" : "{{ user `ami-builder-subnet-id` }}",
	    			"tags" : {
                "Name" : "{{ user `ami-name` }}"
            },
            "run_tags" : {
                "Name" : "{{ user `ami-name` }}"
            },
            "run_volume_tags" : {
                "Name" : "{{ user `ami-name` }}"
            },
            "snapshot_tags" : {
                "Name" : "{{ user `ami-name` }}"
            },
						"launch_block_device_mappings": [
    	    		{
                	"device_name": "/dev/xvda",
                	"encrypted": "true",
									"kms_key_id": "{{ user `kms-key-id` }}",
									"volume_size": "{{ user `volume-size` }}",
                	"delete_on_termination": true
            	}
	    			]
			}	
     ],
     "provisioners" : [
				{
					"type": "file",
					"source": "scripts/docker/metasploit",
					"destination": "/home/ec2-user/tools/downloads"
				},
				{
            "type" : "shell",
            "execute_command": "chmod +x {{ .Path }}; . '{{ .Path }}' {{ user `processor` }}",
            "scripts" : [
 							"scripts/docker/docker-start.sh",
							"scripts/docker/nikto/nikto.sh",
							"scripts/linux-arm/pt/nmap.sh",
							"scripts/linux-arm/pt/pttools.sh",
							"scripts/docker/docker-start.sh",
 							"scripts/docker/nikto/nikto.sh",
              "scripts/docker/metasploit/metasploit.sh",
              "scripts/docker/azurecli/azurecli.sh",
              "scripts/docker/wpscan/wpscan.sh",
              "scripts/docker/linkfinder/linkfinder.sh",
              "scripts/linux-arm/cleanup.sh"
            ]
         }
    ]
}
